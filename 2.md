# 1.OracleソフトウェアのインストールとDBの作成

## 1.Oracleソフトウェアのインストール

### 1.Oracleソフトウェアインストールの全体像

### 2.前提条件の確認
* サポートされているOSバージョンであること
* ストレージの空き容量が十分にあること
* 物理メモリーサイズが十分にあること
* インストールに使用suruOSユーザ、およびグループが存在すること

### 3.OSへの設定（OSユーザ、OSグループ、環境変数）

1. OSユーザとグループを作成する
   * 必要なOSユーザ
     * Oracleソフトウェア所有者
       * Oracleをインストール、管理するOSユーザユーザ
       * Oracleインベントリグループ、OSDBAグループに所属
       * 通常、ユーザ名は"oracle"
   * 必要なOSグループ
     * Oracleインベントリグループ:oinstall
       * Oracleに関連するファイルを共有するOSユーザグループ
     * OSDBAグループ:dba
       * Oracleの管理権限が付与されるOSグループ
     * OSOPERグループ:oper
       * SYSOPER管理権限が付与されるOSグループ
     * OSBACKUPDBAグループ:backupdba
       * バックアップ及びリカバリ関連の管理権限(SYSBACKUP管理権限)が付与されるOSグループ
     * OSDGDBAグループ:dgdba
       * DataGuard関連の管理権限(SYSDG管理権限)が付与されるOSグループ
     * OSKMDBAグループ:kmdba
       * 暗号化鍵関連の管理権限(SYSKM管理権限)が付与されるOSグループ
     * OSRACDBAグループ:racdba
       * RAC関連の管理権限(SYSRAC管理権限)が付与されるOSグループ
2. 作成したOSユーザに環境変数を設定する
   * Linux,UNIX環境で必要な環境変数
     * ORACLE_BASE
       * Oracle関連ファイルの基準となるディレクトリのパス
       * DBファイルファイル、ログファイルなど、Oracleに関連する殆どのファイルがORACLE_BASE以下に配置される
     * ORACLE_HOME
       * Oracleのソフトウェアを配置するディレクトリのパス
       * ORACLE_BASEのサブディレクトリに配置される
     * ORACLE_SID
       * インスタンスの識別子であるSIDを設定
       * この環境変数により、接続先インスタンスが識別される
       * 原則的に「インスタンスのSID＝DB名」
         * DB作成時に、DBCAで指定するDB程度名を設定する（シングル構成の場合）

### 4.OUIによるOracleソフトウェアのインストール
1. ORACLE_HOMEにインストールファイルを展開する
* ORACLE_HOMEに対応するディレクトリにインストールファイルを展開する
* zip圧縮されてるので、unzipコマンドで展開する
  ```
  $ cd ORACLE_HOME(/u01/app/oracle/product/19.3.0/dbhome_1
  $ unzip <インストールファイル.zip>
  ```

2. OUIの起動まで
* runinstallerを実行してOUIを起動
  ```
  $ ./runInstaller
  ```

3. 構成オプションの選択
* ソフトウェアのみの設定
  * Oracleのインストールだけを行う
  * 今回はこっちですすめる
    * ソフトウェアインストール後、DBCAを用いてDBを作成する
* 単一インスタンス・DBを作成及び構成
  * インストールと同時にDBを作成する
4. インストールオプションの選択
* デフォルトの内容で進める
5. DBエディションの選択
* デフォルトの内容で進める
6. インストール場所の指定
* Oracleベースに、**ORACLE_BASE**に設定したディレクトリパスを指定する
  * /u01/app/oracle
* ソフトウェアの場所=runInstallerを起動した**ORACLE_HOME**のディレクトリパスが表示されてるはず
7. インベントリの作成
* デフォルトの内容ですすめる
* **インベントリディレクトリ**：そのマシンにインストールしたOracle製品の情報を記録するディレクトリ
  * Oracleソフトウェアへのパッチ適用、アップグレードや削除に使用される
  * 通常：oinstall
  * マシンに他のOracle製品がインストール済みで、既にインベントリが存在する場合、この画面はスキップされる
8. 権限のあるOSグループ
* インストール前に作成したOSグループを指定する
* デフォルトの設定で進める
9. rootスクリプトの実行構成
* **構成スクリプトを自動的に実行**：選択すると、ソフトウェアのインストール中に下記スクリプトがrootユーザで実行される
  * orainstRoot.sh
    * インベントリポインタファイル(/etc/oraInst.loc)が作成される
      * インベントリ(インストールしたOracleソフトウェア)の場所、管理グループが記録される
  * root.sh
    * oraenvスクリプト、coraenvスクリプト、dbhomeスクリプトが指定したディレクトリにコピーされる
    * /etc/oratabファイルが作成、編集される
* 「構成スクリプトを自動的に実行」を選択しない場合、上記スクリプトをrootユーザで手動実行する必要がある
10. 前提条件チェックの実行
* 前提条件が満たされているかがチェックされ、結果が表示される
11. サマリー
* これまで入力した項目のサマリーが表示される
* 確認して、インストールボタンを押したらインストールが開始される
12. 製品のインストール
* インストールの進捗状況が表示される
13. 構成スクリプトの実行の確認
* 構成スクリプトを自動的に実行しますがよろしいですか？(Y/N)

## 2.OracleDBの作成
### 1.DBCA:Database Configuration Assistant
* OUIを使用したソフトウェアのインストール完了後、DBを作成する(Oracleソフトウェアインストールの際に、「構成オプションの選択」において、DBの作成を行っていない場合)
* DBCAを使用する
```
$ dbca
```
### 2.DBCAを使用したDBの作成
1. DB操作の選択 
  * DBの作成
2. DB作成モードの選択
  * 標準構成
    * 一般的な構成でDB作成
    * DBCAの入力項目が少なくなる
      * グローバル・DB名:oracle.us.oracle.com
        * DBを識別する名前
        * 原則的にDB程度名＝ORACLE_SID
      * 記憶域タイプ：[ファイルシステム]
        * DBファイルをどの記憶域に配置するかの指定
          * [ファイルシステム]
            * DBファイルの位置で指定したディレクトリ以下にDBファイルを配置
          * [自動ストレージ管理]
            * ASMディスクグループにDBファイルを配置
      * DBファイルの位置：[ORACLE_BASE]/oradata/[DB_UNIQUE_NAME]
        * 記憶域タイプでファイルシステムを拡張した場合、DBファイルを格納するディレクトリパスを指定する
        * 自動ストレージ管理を選択した場合、ASMディスクグループを選択する
      * 高速リカバリ領域：[ORACLE_BASE]/fast_recovery_area/[DB_UNIQUE_NAME]
        * バックアップ及びリカバリの領域を指定する
      * DB文字セット:AL32UTF8
        * DBに使用するキャラクタセットの選択。文字コードに相当
      * 管理者パスワード:(非表示)
        * SYS,SYSTEMなどの管理用ユーザのパスワード
        * 管理用ユーザは、DB作成時に自動的に作成される
      * コンテナ・DBとして作成（チェックボックス）:未チェック
        * これから作成するDBをマルチテナントDBとするか否か（BronzeDBAの範囲外）
  * 拡張構成
    *カスタマイズが可能
      * 記憶域の場所、初期化パラメータ、管理オプション、DBオプション、管理用ユーザのパスワード、サンプルスキーマ、メモリー方式etc
    
3. サマリー
* これまで入力した項目のサマリーが表示される
4. 進行状況ページ
* DBの進行状況が表示される
5. DB作成完了後
* Database Configuration Assistantウィンドウが開く
* 下記情報が確認できる
  * DBCAログファイルの場所
  * グローバルDB名
  * SID
  * DBのサーバパラメータファイル名

### 3.テンプレートの管理
#### テンプレートとは
* DBCAでDBを作成するときの雛形
* デフォルトで構成済みのテンプレートが用意されている
* DBCAはテンプレートをもとにDBを作成する
* テンプレートを他のDBサーバにコピーして使うことも可能
* 下記情報が含まれる
  * DBオプション
  * 初期化パラメータ
  * 記憶域属性
    * データファイル
    * 表領域
    * 制御ファイル
    * REDOログの属性
* 実体はXMLファイル
* <ORACLE_HOME>/assitstants/dbca/templatesに格納されてる

#### テンプレートの種類
* シード
  * テンプレートにデータファイルが含まれる
    * 作成時間を短縮できる
  * シードDBの複製として、DBを作成する
  * DBの構成はシードDBに準ずるものになる
    * 柔軟な構成が難しくなる
  * 変更できる点は下記
    * DBの名前
    * データファイルの格納先
    * 制御ファイルノアk図
    * REDOロググループの数
    * 初期化パラメータ
* 非シード
  * テンプレートにデータファイルが含まれない
    * 作成時間が長くなる
    * 柔軟な構成に対応できる
      * ファイルの名前
      * サイズ
      * その他属性等必要に応じて変更可能
#### テンプレートの作成
* 既存のDBまたはテンプレートをもとに作成する
  * 既存のテンプレートからテンプレートを作成
    * 事前構成済みのテンプレート設定に基づく、新しいテンプレートを作成できる
    * 初期化パラメータ、記憶域パラメータ、カスタムスクリプトの使用などのテンプレート設定を追加変更できる
  * 既存のDBからテンプレートを作成
    * 既存DBの構成情報（DBオプション、表領域、データファイル、初期化パラメータなど）を持つ新しいテンプレートを作成
    * ユーザ定義スキーマとそのデータは、作成するテンプレートには含まれない
    * **元のDBはローカルでもリモートでも可**
  * 既存のDBからテンプレートを作成（データファイルを含める）
    * 既存DBの構成情報と、既存DBの物理データファイルを含む新しいテンプレートを作成
    * ユーザ定義スキーマとそのデータは、作成するテンプレートにも含まれる
    * このテンプレートを使用して作成したDBは、元になるDBと同一になる
    * **元のDBは、ローカルにある日強グアある**
#### テンプレートの削除
  * 作成済みテンプレートの削除が可能